# MAOS Development Environment Stack
# Purpose: Ensure local ≠ CI consistency for agents + humans.
# Usage: source stack.env && just validate-stack

# Rust Toolchain
RUST_TOOLCHAIN=stable
RUST_EDITION=2024
CARGO_RESOLVER=3

# Build Configuration  
BUILD_FLAGS="--strict --warnings-as-errors"
CARGO_TERM_COLOR=always

# Development Tools
JUST_VERSION=1.35.0
RUSTFMT_VERSION=stable
CLIPPY_VERSION=stable

# Platform Requirements (enforced by validate-stack)
MIN_MACOS_VERSION=12.0
MIN_UBUNTU_VERSION=20.04
# Note: Windows requires WSL2 (Windows 10+)

# CI Environment Specification
CI_ENV=gh-actions
CI_RUST_TOOLCHAIN=stable
CI_CACHE_VERSION=v2

# Test Configuration
# Test profiles: fast (dev), thorough (pre-commit), ci (GitHub Actions)
MAOS_TEST_PROFILE="${MAOS_TEST_PROFILE:-fast}"

# Namespaced test environment variables based on profile  
case "$MAOS_TEST_PROFILE" in
    fast)
        export MAOS_TEST_SECURITY_PROPTEST_CASES=10
        export MAOS_TEST_E2E_TIMEOUT_MS=5000
        export MAOS_TEST_BENCHMARK_ITERATIONS=10
        ;;
    thorough)
        export MAOS_TEST_SECURITY_PROPTEST_CASES=100
        export MAOS_TEST_E2E_TIMEOUT_MS=10000
        export MAOS_TEST_BENCHMARK_ITERATIONS=100
        ;;
    ci)
        export MAOS_TEST_SECURITY_PROPTEST_CASES=1000
        export MAOS_TEST_E2E_TIMEOUT_MS=120000  # 2 minutes for CI
        export MAOS_TEST_BENCHMARK_ITERATIONS=1000
        ;;
    *)
        echo "⚠️  Unknown test profile: $MAOS_TEST_PROFILE (using 'fast' defaults)"
        export MAOS_TEST_SECURITY_PROPTEST_CASES=10
        export MAOS_TEST_E2E_TIMEOUT_MS=5000
        export MAOS_TEST_BENCHMARK_ITERATIONS=10
        ;;
esac

# Validation Commands:
# > source stack.env
# > just validate-stack
# > MAOS_TEST_PROFILE=thorough just test